# 第二章 Go的内部机制

All the Go features that you learned in the previous chapter are extremely handy and you will be using them all the time. However, there is nothing as rewarding as being able to see and understand what is going on in the background and how Go operates behind the scenes.

In this chapter, you are going to learn about the Go garbage collector and the way it works. Additionally, you will find out how to call C code from your Go programs, which you might find indispensable in some situations. However, you will not need to use this capability too often because Go is a very capable programming language.

Furthermore, you will learn how to call Go code from your C programs, along with how to use the panic() and recover() functions and the defer keyword.

This chapter covers:

The Go compiler
How garbage collection works in Go
How to check the operation of the garbage collector
Calling C code from your Go code
Calling Go code from a C program
The panic() and recover() functions
The unsafe package
The handy, yet tricky, defer keyword
The strace(1) Linux utility
The dtrace(1) utility, which can be found in FreeBSD systems, including macOS Mojave
Finding out information about your Go environment
The node trees created by Go
Creating WebAssembly code from Go
The Go assembler

本章学习以下内容：

- Go编译器
- Go的垃圾回收是如何工作的
- 如何检查垃圾回收器的操作
- 在Go代码中调用C代码
- 在C程序中调用Go代码
- 函数`panic()`和`recover()`
- `unsafe`包
- 方便且具有技巧性的`defer`关键字
- Linux工具`strace(1)`
- FreeBSD和MacOS中的工具`dstrace(1)`
- Go环境变量的更多内容
- Go所创建的node tree
- 用Go创建WebAssembly代码
- Go的汇编器

## Go编译器

The Go compiler is executed with the help of the go tool, which does many more things
than just generating executable files.

## 垃圾回收

## 在Go中调用C代码

## 在C代码中调用Go函数

## 关键字defer

The defer keyword postpones the execution of a function until the surrounding function
returns, which is widely used in file input and output operations because it saves you from
having to remember when to close an opened file. The defer keyword allows you to put
the function call that closes an opened file near to the function call that opened it. As you
will learn about the use of defer in file-related operations in Chapter 8 , Telling a UNIX
System What to Do, this section will present two different usages of defer . You will also see
defer in action in the section that talks about the panic() and recover() built-in Go
functions, as well as in the section that is related to logging.

关键字defer延缓了被包裹函数的执行，直到有结果返回，它被广泛用于文件输入和输出的操作上，因为它免去了你必须记住对已打开文件进行关闭的麻烦。关键字`defer`

It is very important to remember that deferred functions are executed in last in, first out
(LIFO) order after the return of the surrounding function. Putting it simply, this means that
if you defer function f1() first, function f2() second, and function f3() third in the
same surrounding function, when the surrounding function is about to return, function
f3() will be executed first, function f2() will be executed second, and function f1() will
be the last one to get executed.

非常重要的一点是你要记住使用了defer的函数在包裹的函数返回之后按照后进先出的顺序来执行。简单来说，就是如果你在同一个包裹函数中分别按照顺序对f1()，f2()，f3()使用defer，那么在包裹函数执行返回时，那么函数f3()将被第一个执行，

## 
