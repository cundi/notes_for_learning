# Ansible

## Moudle

特性：

- Moudle执行在远程主机上。
- 模块的返回值必须是json格式字符串。

执行过程：

- 模块文件读取（本地）：

    1. 载入内存
    2. 接收参数
    3. 调用的类被载入内存，压缩，base64编码
    4. 将上面压缩并编码后的类写入模块文件

- 模块文件的传输（本地和远程主机）：

    1. 需要三次ssh连接
    2. 第一次，创建临时目录，然后关闭连接
    3. 第二次，使用sftp协议传输本地模块的模板到远程主机的临时目录，然后关闭连接
    4. 第三次，为远程主机中临时目录模块文件赋予执行权限，然后关闭连接

- 模块文件的执行（远程主机）：

    1. 只需一次ssh连接
    2. 执行模块
    3. 递归删除临时目录
    4. 返回json字符串
    5. 关闭连接

以上模块文件的传输和执行使用了4次SSH连接，如果有需要可以改为“管道连接”。即，从本地传输到远程主机返回执行结果仅建立一次SSH连接。

## Plugins